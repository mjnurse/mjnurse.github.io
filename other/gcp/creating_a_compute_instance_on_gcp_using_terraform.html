<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Google Cloud Platform" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/fa62c117c7.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/lunr/lunr.js"></script>
    <link rel="stylesheet" href="/static/styles.css" />
    <link rel="stylesheet" href="/static/syntax.css" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <title>Google Cloud Platform</title>
  </head>
  <body class="light" id="top">
    <header class="header center">
      <h3>
        <a href="/" class="link">MjN</a>
      </h3>

      <nav class="nav center">
        <ul class="nav__list center">
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/blog/" data-shortcut="b"><strong>b</strong>log</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/cheatsheets/" data-shortcut="c"><strong>c</strong>heatsheets</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/elasticsearch/" data-shortcut="e"><strong>e</strong>lasticsearch</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/js/" data-shortcut="j"><strong>j</strong>s</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/linuxbash/" data-shortcut="l"><strong>l</strong>inuxbash</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/misc/" data-shortcut="m"><strong>m</strong>isc</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/notes/" data-shortcut="n"><strong>n</strong>otes</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/other/" data-shortcut="o"><strong>o</strong>ther</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/python/" data-shortcut="p"><strong>p</strong>ython</a>
          </li>
          
        </ul>

        <button type="button" aria-label="search" id="searchBtn" class="btn btn--icon">
          <i aria-hidden="true" class="fas fa-search"></i>
        </button>

        <button type="button" aria-label="toggle theme" class="btn btn--icon">
          <i aria-hidden="true" id="btn-theme" class="fas fa-moon"></i>
        </button>

        <button
          type="button"
          aria-label="toggle navigation"
          class="btn btn--icon nav__hamburger"
        >
          <i aria-hidden="true" class="fas fa-bars"></i>
        </button>
      </nav>
    </header>

    <main>
      <article class="article">
        <div class="article-body">
          <h1><a href="#" data-clipboard="code ~/mjnurse/mjnurse-website/other/gcp/Creating_a_Compute_Instance_on_GCP_Using_Terraform.md">Google Cloud Platform</a></h1>
<h1 id="creating-a-compute-instance-on-gcp-using-terraform">Creating a Compute Instance on GCP Using Terraform</h1>
<h3 id="download-and-install-terraform">Download and Install terraform</h3>
<p>Download the most recent version of Terraform.  No install, its just an executable.  Move it to an accessible location.</p>
<div class="codehilite"><pre><span></span><code><span class="k">&gt; </span><span class="ge">wget https://releases.hashicorp.com/terraform/0.11.11/terraform_0.11.11_linux_amd64.zip</span>
...
<span class="k">&gt; </span><span class="ge">unzip terraform_0.11.11_linux_amd64.zip</span>
...
<span class="k">&gt; </span><span class="ge">mv terraform ~/bin</span>
...
<span class="k">&gt; </span><span class="ge">terraform --version</span>
Terraform v0.11.11
</code></pre></div>

<h3 id="create-a-terraform-config-file">Create a terraform Config File</h3>
<p>Create a provider config file: <code>main.tf</code></p>
<div class="codehilite"><pre><span></span><code>provider<span class="w"> </span>&quot;google&quot;<span class="w"> </span>{
<span class="w">  </span>project<span class="w"> </span>=<span class="w"> </span>&quot;mjnurse-terraform&quot;
<span class="w">  </span>region<span class="w">  </span>=<span class="w"> </span>&quot;us-central1&quot;
<span class="w">  </span>zone<span class="w">    </span>=<span class="w"> </span>&quot;us-central1-c&quot;
}

resource<span class="w"> </span>&quot;google_compute_instance&quot;<span class="w"> </span>&quot;vm_instance&quot;<span class="w"> </span>{
<span class="w">  </span>name<span class="w">         </span>=<span class="w"> </span>&quot;terraform-instance&quot;
<span class="w">  </span>#machine_type<span class="w"> </span>=<span class="w"> </span>&quot;f1-micro&quot;
<span class="w">  </span>machine_type<span class="w"> </span>=<span class="w"> </span>&quot;n1-standard-4&quot;

<span class="w">  </span>boot_disk<span class="w"> </span>{
<span class="w">    </span>initialize_params<span class="w"> </span>{
<span class="w">      </span>image<span class="w"> </span>=<span class="w"> </span>&quot;debian-cloud/debian-9&quot;
<span class="w">    </span>}
<span class="w">  </span>}

<span class="w">  </span>network_interface<span class="w"> </span>{
<span class="w">    </span>#<span class="w"> </span>A<span class="w"> </span>default<span class="w"> </span>network<span class="w"> </span>is<span class="w"> </span>created<span class="w"> </span>for<span class="w"> </span>all<span class="w"> </span>GCP<span class="w"> </span>projects
<span class="w">    </span>network<span class="w">       </span>=<span class="w"> </span>&quot;<span class="cp">${</span><span class="n">google_compute_network</span><span class="o">.</span><span class="n">vpc_network</span><span class="o">.</span><span class="n">self_link</span><span class="cp">}</span>&quot;
<span class="w">    </span>access_config<span class="w"> </span>=<span class="w"> </span>{
<span class="w">    </span>}
<span class="w">  </span>}
}

resource<span class="w"> </span>&quot;google_compute_network&quot;<span class="w"> </span>&quot;vpc_network&quot;<span class="w"> </span>{
<span class="w">  </span>name<span class="w">                    </span>=<span class="w"> </span>&quot;terraform-network&quot;
<span class="w">  </span>auto_create_subnetworks<span class="w"> </span>=<span class="w"> </span>&quot;true&quot;
}
</code></pre></div>

<h3 id="set-up-the-required-credentials">Set Up the Required Credentials</h3>
<p>From the Navigation Menu, select APIs &amp; Services, Credentials.  From the Create credentials drop down, select 'Service account key'.  ENsure that the JSON option is selected amd choose the 'Compute Engine default service account' from the drop down.  Click create and a JSON document will be downloaded by the browser.</p>
<p>Copy the contents of the JSON download in to a file called google_cloud_keyfile.json.</p>
<p>create and environment variavle to point to this file:</p>
<div class="codehilite"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="k">export</span><span class="w"> </span><span class="n">GOOGLE_CLOUD_KEYFILE_JSON</span><span class="o">=</span><span class="n">google_cloud_keyfile</span><span class="o">.</span><span class="n">json</span>
</code></pre></div>

<h3 id="run-the-terraform-script-to-create-the-compute-instance">Run the terraform Script to Create the Compute Instance</h3>
<p>Run terraform init:</p>
<div class="codehilite"><pre><span></span><code><span class="k">&gt; </span><span class="ge">terraform init</span>

<span class="k">*</span> provider.google: version = &quot;~&gt; 2.0&quot;

Terraform has been successfully initialized!
</code></pre></div>

<p>Run the terraform <code>main.tf</code> script:</p>
<div class="codehilite"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">terraform</span><span class="w"> </span><span class="n">apply</span>

<span class="n">martin</span><span class="nv">@website</span><span class="o">-</span><span class="nl">builder</span><span class="p">:</span><span class="o">~/</span><span class="n">terraform</span><span class="err">$</span><span class="w"> </span><span class="n">terraform</span><span class="w"> </span><span class="n">apply</span>
<span class="n">google_compute_network</span><span class="p">.</span><span class="nl">vpc_network</span><span class="p">:</span><span class="w"> </span><span class="n">Refreshing</span><span class="w"> </span><span class="k">state</span><span class="p">...</span><span class="w"> </span><span class="p">(</span><span class="nl">ID</span><span class="p">:</span><span class="w"> </span><span class="n">terraform</span><span class="o">-</span><span class="n">network</span><span class="p">)</span>
<span class="n">google_compute_instance</span><span class="p">.</span><span class="nl">vm_instance</span><span class="p">:</span><span class="w"> </span><span class="n">Refreshing</span><span class="w"> </span><span class="k">state</span><span class="p">...</span><span class="w"> </span><span class="p">(</span><span class="nl">ID</span><span class="p">:</span><span class="w"> </span><span class="n">terraform</span><span class="o">-</span><span class="n">instance</span><span class="p">)</span>

<span class="n">An</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="k">plan</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">shown</span><span class="w"> </span><span class="n">below</span><span class="p">.</span>
<span class="n">Resource</span><span class="w"> </span><span class="n">actions</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">indicated</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="nl">symbols</span><span class="p">:</span>
<span class="p">...</span>
<span class="k">Plan</span><span class="err">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">add</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">change</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">destroy</span><span class="p">.</span>

<span class="n">Do</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">actions</span><span class="vm">?</span>
<span class="w">  </span><span class="n">Terraform</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">actions</span><span class="w"> </span><span class="n">described</span><span class="w"> </span><span class="n">above</span><span class="p">.</span>
<span class="w">  </span><span class="k">Only</span><span class="w"> </span><span class="s1">&#39;yes&#39;</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">accepted</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">approve</span><span class="p">.</span>

<span class="w">  </span><span class="n">Enter</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">value</span><span class="err">:</span><span class="w"> </span><span class="n">yes</span>

<span class="n">google_compute_instance</span><span class="p">.</span><span class="nl">vm_instance</span><span class="p">:</span><span class="w"> </span><span class="n">Creating</span><span class="p">...</span>
<span class="p">...</span>
<span class="n">google_compute_instance</span><span class="p">.</span><span class="nl">vm_instance</span><span class="p">:</span><span class="w"> </span><span class="n">Still</span><span class="w"> </span><span class="n">creating</span><span class="p">...</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="n">s</span><span class="w"> </span><span class="n">elapsed</span><span class="p">)</span>
<span class="n">google_compute_instance</span><span class="p">.</span><span class="nl">vm_instance</span><span class="p">:</span><span class="w"> </span><span class="n">Still</span><span class="w"> </span><span class="n">creating</span><span class="p">...</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="n">s</span><span class="w"> </span><span class="n">elapsed</span><span class="p">)</span>
<span class="n">google_compute_instance</span><span class="p">.</span><span class="nl">vm_instance</span><span class="p">:</span><span class="w"> </span><span class="n">Creation</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="mi">29</span><span class="n">s</span><span class="w"> </span><span class="p">(</span><span class="nl">ID</span><span class="p">:</span><span class="w"> </span><span class="n">terraform</span><span class="o">-</span><span class="n">instance</span><span class="p">)</span>

<span class="n">Apply</span><span class="w"> </span><span class="n">complete</span><span class="err">!</span><span class="w"> </span><span class="nl">Resources</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">added</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">changed</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">destroyed</span><span class="p">.</span>
</code></pre></div>

<h3 id="removing-the-compute-instance">Removing the Compute Instance</h3>
<div class="codehilite"><pre><span></span><code><span class="k">&gt; </span><span class="ge">terraform destroy</span>

google_compute_network.vpc_network: Refreshing state... (ID: terraform-network)
google_compute_instance.vm_instance: Refreshing state... (ID: terraform-instance)

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  <span class="k">-</span> destroy

Terraform will perform the following actions:
  <span class="k">-</span> google_compute_instance.vm_instance
  <span class="k">-</span> google_compute_network.vpc_network

Plan: 0 to add, 0 to change, 2 to destroy.

Do you really want to destroy all resources?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only &#39;yes&#39; will be accepted to confirm.

  Enter a value: yes

google_compute_instance.vm_instance: Destroying... (ID: terraform-instance)
google_compute_instance.vm_instance: Destruction complete after 4s
google_compute_network.vpc_network: Destroying... (ID: terraform-network)
google_compute_network.vpc_network: Still destroying... (ID: terraform-network, 1m0s elapsed)
google_compute_network.vpc_network: Destruction complete after 1m6s

Destroy complete! Resources: 2 destroyed.
</code></pre></div>

<hr>
        </div>
      </article>
    </main>

    <footer class="footer">
      <p>
        <a href="/about_me.html" class="link">About Me</a> | 
        <a href="/help.html" class="link">Help</a>
      </p>
      <p>
        <a href="https://github.com/mjnurse" target="_blank" rel="noopener noreferrer" aria-label="GitHub" class="link footer__link">
          <i aria-hidden="true" class="fab fa-github"></i>
        </a>
        <a href="https://www.linkedin.com/in/martin-nurse" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" class="link footer__link">
          <i aria-hidden="true" class="fab fa-linkedin"></i>
        </a>
      </p>
      <p>Last updated: December 11, 2025</p>
    </footer>

    <div class="scroll-container">
      <div class="scroll-top">
        <a aria-label="Scroll up" href="#top">
          <i aria-hidden="true" class="fas fa-arrow-up"></i>
        </a>
      </div>
    </div>

    <script src="/static/page-nav.js"></script>
    <script src="/static/script.js"></script>
    <script src="/static/search.js"></script>
  </body>
</html>