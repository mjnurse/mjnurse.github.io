<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="es.def" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/fa62c117c7.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/lunr/lunr.js"></script>
    <link rel="stylesheet" href="/static/styles.css" />
    <link rel="stylesheet" href="/static/syntax.css" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <title>es.def</title>
  </head>
  <body class="light" id="top">
    <header class="header center">
      <h3>
        <a href="/" class="link">MjN</a>
      </h3>

      <nav class="nav center">
        <ul class="nav__list center">
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/blog/" data-shortcut="b"><strong>b</strong>log</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/cheatsheets/" data-shortcut="c"><strong>c</strong>heatsheets</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/elasticsearch/" data-shortcut="e"><strong>e</strong>lasticsearch</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/js/" data-shortcut="j"><strong>j</strong>s</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/linuxbash/" data-shortcut="l"><strong>l</strong>inuxbash</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/misc/" data-shortcut="m"><strong>m</strong>isc</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/notes/" data-shortcut="n"><strong>n</strong>otes</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/other/" data-shortcut="o"><strong>o</strong>ther</a>
          </li>
          
          <li class="nav__list-item">
            <a class="link link--nav" href="/shortcutkeys/" data-shortcut="s"><strong>s</strong>hortcutkeys</a>
          </li>
          
        </ul>

        <button type="button" aria-label="search" id="searchBtn" class="btn btn--icon">
          <i aria-hidden="true" class="fas fa-search"></i>
        </button>

        <button type="button" aria-label="toggle theme" class="btn btn--icon">
          <i aria-hidden="true" id="btn-theme" class="fas fa-moon"></i>
        </button>

        <button
          type="button"
          aria-label="toggle navigation"
          class="btn btn--icon nav__hamburger"
        >
          <i aria-hidden="true" class="fas fa-bars"></i>
        </button>
      </nav>
    </header>

    <main>
      <article class="article">
        <div class="article-body">
          <h1>es.def</h1>
<pre class="codehilite"><code class="language-bash"># ES

cmd ES_AUTH=&quot;&quot;
cmd ES_HOST=&quot;${ES_HOST:-localhost}&quot;
cmd ES_PORT=&quot;${ES_PORT:-9200}&quot;

# ----------------------------------------------------------------------------------------------------------------------------------
= CLUSTER
# ----------------------------------------------------------------------------------------------------------------------------------

clear cache (cc) [&lt;index_name&gt;] :: \
   curl -X POST &quot;http://$ES_HOST:$ES_PORT/$1/_cache/clear&quot;

cluster overview (co) :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/&quot;

cluster health (ch) :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cluster/health?human&amp;pretty&quot;

cluster stats (cs) :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cluster/stats?human&amp;pretty&quot;

# ----------------------------------------------------------------------------------------------------------------------------------
= INDEX INTERROGATION
# ----------------------------------------------------------------------------------------------------------------------------------

count (c) &lt;index_name&gt; :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/$1/_count?pretty&quot;

list aliases (la) [&lt;filter&gt;] [&lt;order_by_field_name&gt;] :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/aliases/$1?v&amp;s=$2&quot;

list indices (li) [&lt;index_name&gt;] :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/indices/$1?v&amp;h=health,status,index,pri,rep,sc,docs.count,docs.deleted,store.size,pri.store.size&amp;s=index&quot;

list shards (ls) [&lt;index_name&gt;] [&lt;order_by_field_name&gt;] :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/shards/$1?v&amp;h=index,shard,prirep,sc,state,docs,store,node&amp;s=index,shard,prirep&amp;s=$2&quot;

list shard details (lsd) [&lt;index_name&gt;] [&lt;order_by_field_name&gt;] :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/shards/$1?v&amp;h=index,shard,prirep,state,docs,store,ip,segments.count,unassigned.reason,unassigned.for,node&amp;s=$2&quot;

list segments (le) [&lt;index_name&gt;] :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/segments/$1?v&amp;s=index,shard,prirep&quot;

list segmented shards (lss) [&lt;index_name&gt;] :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/shards/$1?v&amp;h=index,shard,prirep,state,docs,node,segments.count&amp;s=index,shard,prirep,node&quot;

get index mapping (gim) &lt;index_name&gt; :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/$1/_mapping?pretty&quot;

list unassigned shards (lus) :: curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/shards?v&amp;h=index,shard,prirep,state,docs,segments.count&amp;s=index,shard,prirep&quot; 

forcemerge progress (fmp) :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/nodes?v&amp;h=name,cpu,load_1m,merges.current,merges.current_docs,merges.total,merges.total_docs&amp;s=name&quot;

# ----------------------------------------------------------------------------------------------------------------------------------
= INDEX MANIPULATION
# ----------------------------------------------------------------------------------------------------------------------------------

add index to alias (aita) &lt;index_name&gt; &lt;alias_name&gt; :: \
   curl -X POST &quot;http://$ES_HOST:$ES_PORT/_aliases&quot; -H 'Content-Type: application/json' -d '{&quot;actions&quot;:[{&quot;add&quot;:{&quot;index&quot;:&quot;'$1'&quot;,&quot;alias&quot;:&quot;'$2'&quot;}}]}'

remove index from alias (rifa) &lt;index_name&gt; &lt;alias_name&gt; :: \
   read -p &quot;Are you sure [yN]? &quot; yn; \
   if [[ ${yn^} == Y ]]; then \
      curl -X DELETE &quot;http://$ES_HOST:$ES_PORT/$1/_aliases/$2&quot;; \
   fi

create index (ci) &lt;index_name&gt; &lt;number_of_shards&gt; &lt;number_of_replicas&gt; :: \
   curl -X PUT &quot;http://$ES_HOST:$ES_PORT/$1&quot; -H 'Content-Type: application/json' -d '{&quot;settings&quot;:{&quot;index&quot;:{&quot;number_of_shards&quot;:'$2',&quot;number_of_replicas&quot;:'$3'}}}'

create index from mapping (cifm) &lt;index_name&gt; &lt;number_of_shards&gt; &lt;number_of_replicas&gt; &lt;mapping-json&gt; :: \
   curl -X PUT &quot;http://$ES_HOST:$ES_PORT/$1&quot; -H 'Content-Type: application/json' -d '{&quot;settings&quot;:{&quot;index&quot;:{&quot;number_of_shards&quot;:'$2',&quot;number_of_replicas&quot;:'$3'}},&quot;mappings&quot;:'$4'}'

clone index (clni) &lt;index_name&gt; &lt;new_index_name&gt; :: \
   curl -X POST &quot;http://$ES_HOST:$ES_PORT/$1/_clone/$2&quot;

delete index (di) &lt;index_name&gt; :: \
   read -p &quot;Are you sure [yN]? &quot; yn; \
   if [[ ${yn^} == Y ]]; then \
      curl -X DELETE &quot;http://$ES_HOST:$ES_PORT/$1&quot;; \
   fi

open index (opi) &lt;index_name&gt; :: \
   curl -X POST &quot;http://$ES_HOST:$ES_PORT/$1/_open&quot;

close index (cli) &lt;index_name&gt; :: \
   curl -X POST &quot;http://$ES_HOST:$ES_PORT/$1/_close&quot;

enable read only (ero) &lt;index_name&gt; :: \
   curl -X PUT &quot;http://$ES_HOST:$ES_PORT/$1/_settings&quot; -H 'Content-Type: application/json' -d '{&quot;index.blocks.write&quot;: true}'

enable read write (erw) &lt;index_name&gt; :: \
   curl -X PUT &quot;http://$ES_HOST:$ES_PORT/$1/_settings&quot; -H 'Content-Type: application/json' -d '{&quot;index.blocks.write&quot;: false}'

reindex index (ri) &lt;source_index_name&gt; &lt;dest_index_name&gt; :: \
   curl -X POST &quot;http://$ES_HOST:$ES_PORT/_reindex&quot; -H 'Content-Type: application/json' -d '{&quot;source&quot;:{&quot;index&quot;:&quot;'$1'&quot;},&quot;dest&quot;:{&quot;index&quot;:&quot;'$2'&quot;}}'

move shard (ms) &lt;index_name&gt; &lt;shard_num&gt; &lt;from_node_name&gt; &lt;to_node_name&gt; :: \
   curl -X POST &quot;http://$ES_HOST:$ES_PORT/_cluster/reroute&quot; -H 'Content-Type: application/json' -d '{&quot;commands&quot;:[{&quot;move&quot;:{&quot;index&quot;:&quot;'$1'&quot;,&quot;shard&quot;:'$2',&quot;from_node&quot;:&quot;'$3'&quot;,&quot;to_node&quot;:&quot;'$4'&quot;}}]}'

alter number replicas (anr) &lt;index_name&gt; &lt;number_of_replicas&gt; :: \
   curl -X PUT &quot;http://$ES_HOST:$ES_PORT/$1/_settings&quot; -H 'Content-Type: application/json' -d '{&quot;index&quot;:{&quot;number_of_replicas&quot;:'$2'}}'

disable shard allocation (dsa) :: \
   curl -X PUT &quot;http://$ES_HOST:$ES_PORT/_cluster/settings&quot; -H 'Content-Type: application/json' -d '{&quot;persistent&quot;:{&quot;cluster.routing.allocation.enable&quot;:&quot;primaries&quot;}}'

reenable shard allocation (rsa) :: \
   curl -X PUT &quot;http://$ES_HOST:$ES_PORT/_cluster/settings&quot; -H 'Content-Type: application/json' -d '{&quot;persistent&quot;:{&quot;cluster.routing.allocation.enable&quot;:null}}'

forcemerge (fm) &lt;index_name&gt; &lt;max_num_segments&gt; :: \
   curl -X POST &quot;http://$ES_HOST:$ES_PORT/$1/_forcemerge?max_num_segments=$2&quot;

refresh (r) &lt;index_name&gt; :: \
   curl -X POST &quot;http://$ES_HOST:$ES_PORT/$1/_refresh&quot;

# ----------------------------------------------------------------------------------------------------------------------------------
= INDEX ENTRY MANIPULATION
# ----------------------------------------------------------------------------------------------------------------------------------

add entry (ae) &lt;index_name&gt; &lt;entry_json&gt; :: curl -X POST &quot;http://$ES_HOST:$ES_PORT/$1/_doc&quot; -H 'Content-Type: application/json' -d &quot;$2&quot;

# ----------------------------------------------------------------------------------------------------------------------------------
= NODES
# ----------------------------------------------------------------------------------------------------------------------------------

list nodes (ln) :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/nodes?v&amp;h=name,ip,nodeRole,m,heapPercent,ramPercent,cpu,load_1m,load_5m,load_15m,disk.total,disk.used_percent&amp;s=name&quot;

list nodes queries (lnq) :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/nodes?v&amp;h=name,nodeRole,search,queryTotal,searchFetchTotal,requestCacheHitCount&amp;s=name&quot;

search nodes (sn) :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_nodes&quot;

node active threads (at) :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/thread_pool?v&amp;s=node_name,name&quot;

# ----------------------------------------------------------------------------------------------------------------------------------
= SEARCH
# ----------------------------------------------------------------------------------------------------------------------------------

search (s) &lt;index_name&gt; &lt;search_term&gt; :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/$1/_search?q=$2&amp;pretty&quot;

search json (sj) &lt;index_name&gt; &lt;search_json&gt; :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/$1/_search?pretty&quot; -H 'Content-Type: application/json' -d &quot;$2&quot;

search match (sm) &lt;index_name&gt; &lt;field_name&gt; &lt;value&gt; :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/$1/_search?pretty&quot; -H 'Content-Type: application/json' -d '{&quot;query&quot;: { &quot;match&quot;: { &quot;'$2'&quot;: &quot;'$3'&quot; } } }'

search term (st) &lt;index_name&gt; &lt;field_name&gt; &lt;value&gt; :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/$1/_search?pretty&quot; -H 'Content-Type: application/json' -d '{&quot;query&quot;: { &quot;term&quot;: { &quot;'$2'&quot;: &quot;'$3'&quot; } } }'

search summary (ss) &lt;index_name&gt; &lt;search_term&gt; :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/$1/_search?size=0&amp;pretty&quot; -H 'Content-Type: application/json' -d '{&quot;aggs&quot;: {&quot;count&quot;: {&quot;terms&quot;: { &quot;field&quot; : &quot;'$2'&quot;, &quot;size&quot; : 100 } } } }'

# ----------------------------------------------------------------------------------------------------------------------------------
= TASKS
# ----------------------------------------------------------------------------------------------------------------------------------

list tasks (lt) [&lt;sort_field&gt;] :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/tasks?v&amp;h=action,type,start_time,timestamp,running_time,node&amp;s=$1&quot;

list tasks detail (ltd) [&lt;sort_field&gt;] :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/tasks?v&amp;s=$1&quot;

# ----------------------------------------------------------------------------------------------------------------------------------
= REPOS / SNAPSHOTS
# ----------------------------------------------------------------------------------------------------------------------------------

add repo (are) &lt;repo_name&gt; :: \
   curl -X PUT &quot;http://$ES_HOST:$ES_PORT/_snapshot/$1?pretty&quot; -H 'Content-Type: application/json' -d '{ &quot;type&quot;: &quot;fs&quot;, &quot;settings&quot;: { &quot;location&quot;: &quot;'$1'&quot; } } '

delete repo (dre) &lt;repo_name&gt; :: \
   read -p &quot;Are you sure [yN]? &quot; yn; \
   if [[ ${yn^} == Y ]]; then \
      curl -X DELETE &quot;http://$ES_HOST:$ES_PORT/_snapshot/$1?pretty&quot;; \
   fi

list repos (lre) :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/repositories?v&quot;

create snapshot (csn) &lt;repo_name&gt; &lt;snapshot_name&gt; :: \
   curl -X PUT &quot;http://$ES_HOST:$ES_PORT/_snapshot/$1/$2?pretty&quot;

delete snapshot (dsn) &lt;repo_name&gt; &lt;snapshot_name&gt; :: \
   read -p &quot;Are you sure [yN]? &quot; yn; \
   if [[ ${yn^} == Y ]]; then \
      curl -X DELETE &quot;http://$ES_HOST:$ES_PORT/_snapshot/$1/$2?pretty&quot;; \
   fi

list snapshots (lsn) :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_cat/snapshots?v&quot;

snapshot details (snd) &lt;repo_name&gt; &lt;snapshot_name&gt; :: \
   curl -X GET &quot;http://$ES_HOST:$ES_PORT/_snapshot/$1/$2?pretty&quot;

restore snaphot (rsn) &lt;repo_name&gt; &lt;snapshot_name&gt; :: \
   curl -X POST &quot;http://$ES_HOST:$ES_PORT/_snapshot/$1/$2/_restore?pretty&quot;

# ----------------------------------------------------------------------------------------------------------------------------------
= GENERIC
# ----------------------------------------------------------------------------------------------------------------------------------

generic (g) &lt;type-GET/POST/PUT&gt; &lt;api_call&gt; :: curl -X $1 &quot;http://$ES_HOST:$ES_PORT/$2&quot;

query-es settings (qes) :: query-es -s



### overview perf:
###
### curl -s -u $CRED -XGET $EHOST'/_cat/nodes?v&amp;h=ip,port,role,master,cpu,ft,ftt,iic,iif,mt,mtt,d,mcs' | sort

### disk space:
###
### curl -s -u $CRED -XGET $EHOST'/_cat/allocation?v'

### list node attributes:
###
### curl -s -u $CRED -XGET $EHOST'/_cat/nodeattrs?v&amp;s=node'

### get cluster settings - shows what has been set through api, does not show config file settings:
###
### curl -s -u $CRED - XGET $EHOST'/_cluster/settings?pretty'

### debug
### enable debug for every node:
###
### curl -s -u $CRED -XPUT $EHOST'/_cluster/settings?pretty' -d'{&quot;transient&quot;: {&quot;logger.discovery.zen&quot;:&quot;TRACE&quot;}}'

### debug security logger:
###
### &quot;logger.org.elasticsearch.xpack.security&quot; : &quot;TRACE&quot;
### debug ldap logger:
###
### &quot;logger.org.elasticsearch.xpack.security.authc.ldap&quot; : &quot;TRACE&quot;
### dump of all cluster state: nodes, indexes, shards and placements - BIG:
###
### curl -s -u $CRED -XPUT $EHOST'/_cluster/state'

### overview:
###
### get _cat/nodes?v&amp;s=name&amp;h=name,fielddataMemory,fielddataEvictions
### detailed stats on a per field/node basis:
###
### GET /_nodes/stats/indices/fielddata?fields=*
### performance: request cache
### This cache is hit first on the coordinating node and caches a result in its entirety
###
### full request cache stats on a per cluster and per index basis:
###
### GET /_stats/request_cache?human
### TODO: more
###
### performance: shard cache
### This cache is hit second on the participating nodes and caches the shard contents
###
### https://www.elastic.co/guide/en/elasticsearch/reference/master/shard-request-cache.html
###
### TODO: more
###
### threads
### whats running:
###
### curl -s -u $CRED -XGET $EHOST'/_cat/thread_pool'

### thread pool sizes:
###
### curl -s -u $CRED -XGET $EHOST'/_cat/thread_pool?v&amp;h=node_name,name,size,active,queue,queue_size,largest,min,max&amp;s=node_name,name'

### aliases
### list aliases:
###
### curl -s -u $CRED -XGET $EHOST'/_cat/aliases?v'

### change security/kibana index:
###
### curl -s -u $CRED -XPUT $EHOST'/.kibana/_settings?pretty' -d' {&quot;index&quot; : {&quot;number_of_replicas&quot; : 9, &quot;auto_expand_replicas&quot; : false} }'

### templates
### list templates:
###
### curl -s -u $CRED -XGET $EHOST'/_cat/templates?v'

### get security templates:
###
### curl -s -u $CRED -XGET $EHOST'/_template/security-index-template?pretty'

### shards, replicas &amp; recovery
### view the shard states for an index:
###
### curl -k -s -u $CRED -XGET $EHOST'/_cat/shards/ams-txn-061918_jaro?v&amp;s=index,node,sh&amp;h=index,node,sh,pr,state,docs,store,recoverysource.type,unassigned.reason,unassigned.for'

### explain allocation - explain why we have unallocated shards:
###
### curl -s -u $CRED -XGET $EHOST'/_cluster/allocation/explain?pretty'

### list . indices repl:
###
### curl -s -u $CRED -XGET $EHOST'/_cat/indices/.*?v'

### recovery status:
###
### curl -s -u $CRED -XGET $EHOST'/_cat/recovery?v'

# PUT _cluster/settings
# {
#   &quot;transient&quot;: {
#     &quot;cluster.routing.allocation.disk.watermark.low&quot;: &quot;100gb&quot;,
#     &quot;cluster.routing.allocation.disk.watermark.high&quot;: &quot;50gb&quot;,
#     &quot;cluster.routing.allocation.disk.watermark.flood_stage&quot;: &quot;10gb&quot;,
#     &quot;cluster.info.update.interval&quot;: &quot;1m&quot;
#   }
# }
</code></pre>
        </div>
      </article>
    </main>

    <footer class="footer">
      <p>
        <a href="/about_me.html" class="link">About Me</a> | 
        <a href="/help.html" class="link">Help</a>
      </p>
      <p>
        <a href="https://github.com/mjnurse" target="_blank" rel="noopener noreferrer" aria-label="GitHub" class="link footer__link">
          <i aria-hidden="true" class="fab fa-github"></i>
        </a>
        <a href="https://www.linkedin.com/in/martin-nurse" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" class="link footer__link">
          <i aria-hidden="true" class="fab fa-linkedin"></i>
        </a>
      </p>
      <p>Last updated: December 11, 2025</p>
    </footer>

    <div class="scroll-container">
      <div class="scroll-top">
        <a aria-label="Scroll up" href="#top">
          <i aria-hidden="true" class="fas fa-arrow-up"></i>
        </a>
      </div>
    </div>

    <script src="/static/page-nav.js"></script>
    <script src="/static/script.js"></script>
    <script src="/static/search.js"></script>
  </body>
</html>